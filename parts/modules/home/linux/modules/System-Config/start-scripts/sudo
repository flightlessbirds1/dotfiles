#!/usr/bin/env bash
# Wrapper for doas-sudo-shim to filter unsupported flags from nh
# This should be placed earlier in PATH than the system sudo

# Parse arguments and filter out unsupported flags
FILTERED_ARGS=()

for arg in "$@"; do
    case "$arg" in
        --preserve-env|--preserve-env=*|-E)
            # Skip these - doas preserves most env vars by default
            ;;
        *)
            FILTERED_ARGS+=("$arg")
            ;;
    esac
done

# Call the actual doas-sudo-shim
exec /run/current-system/sw/bin/sudo "${FILTERED_ARGS[@]}"